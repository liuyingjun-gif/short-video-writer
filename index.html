<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>çŸ­å½±éŸ³è…³æœ¬ç”Ÿæˆå™¨ï¼ˆä½¿ç”¨è€…è¼¸å…¥é‡‘é‘°ç‰ˆï¼‰</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background: #f9fafb; color: #111827; }
    .card { background: white; border-radius: 1rem; box-shadow: 0 5px 20px rgba(0,0,0,.05); padding: 1.5rem; }
    .btn { border-radius: 9999px; padding: .6rem 1rem; font-weight: 600; }
    .btn-primary { background: #0284c7; color: #fff; }
    .btn-ghost { background: #f3f4f6; color: #111827; }
    .code { background: #0f172a; color: #e2e8f0; border-radius: .75rem; padding: 1rem; overflow: auto; white-space: pre-wrap; }
  </style>
</head>
<body>
  <header class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-2">çŸ­å½±éŸ³è…³æœ¬ç”Ÿæˆå™¨ ğŸ¬</h1>
    <p class="text-gray-600">æ­¤ç‰ˆæœ¬è®“ä½¿ç”¨è€…è‡ªè¡Œè¼¸å…¥ OpenAI API Keyï¼Œè³‡æ–™åƒ…å„²å­˜åœ¨æœ¬æ©Ÿç€è¦½å™¨ã€‚</p>
  </header>

  <main class="max-w-4xl mx-auto px-4 space-y-6 pb-24">
    <!-- é‡‘é‘°è¼¸å…¥å€ -->
    <div class="card">
      <h2 class="text-xl font-semibold mb-3">ç¬¬ä¸€æ­¥ï¼šè¼¸å…¥ä½ çš„ OpenAI API Key</h2>
      <p class="text-sm text-gray-600 mb-3">è«‹è²¼ä¸Šä½ çš„ API é‡‘é‘°ï¼ˆé–‹é ­ç‚º <code>sk-</code>ï¼‰ã€‚æ­¤é‡‘é‘°åƒ…æœƒå„²å­˜åœ¨ä½ çš„ç€è¦½å™¨ï¼Œä¸æœƒä¸Šå‚³ã€‚</p>
      <div class="flex gap-2">
        <input id="userApiKey" type="password" placeholder="sk-xxxxxxxxxxxxxxxx" class="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-400">
        <button id="btnSaveKey" class="btn btn-ghost">å„²å­˜</button>
        <button id="btnClearKey" class="btn btn-ghost">æ¸…é™¤</button>
      </div>
    </div>

    <!-- æ–‡å­—è¼¸å…¥å€ -->
    <div class="card">
      <h2 class="text-xl font-semibold mb-3">ç¬¬äºŒæ­¥ï¼šè²¼ä¸Šæ–‡ç« æˆ–é€å­—ç¨¿</h2>
      <textarea id="inputText" rows="10" placeholder="è«‹è²¼ä¸Šé€å­—ç¨¿æˆ–æ–‡ç« å…§å®¹..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-400"></textarea>
    </div>

    <!-- å‹æ…‹é¸æ“‡ -->
    <div class="card">
      <h2 class="text-xl font-semibold mb-3">ç¬¬ä¸‰æ­¥ï¼šé¸æ“‡å½±ç‰‡å‹æ…‹</h2>
      <div class="space-y-2">
        <label class="flex items-start gap-3">
          <input type="radio" name="mode" value="podcast" checked>
          <span><strong>Podcast ä¸€é¡åˆ°åº•å‹ï¼š</strong>æä¾› 5 æ®µ 45â€“75 ç§’é‡é»ç‰‡æ®µ</span>
        </label>
        <label class="flex items-start gap-3">
          <input type="radio" name="mode" value="topic">
          <span><strong>è­°é¡Œå‹ï¼š</strong>60 ç§’æ—ç™½è…³æœ¬ + å»ºè­°ç•«é¢</span>
        </label>
        <label class="flex items-start gap-3">
          <input type="radio" name="mode" value="people">
          <span><strong>äººç‰©æ•…äº‹å‹ï¼š</strong>åŸéŸ³æ‘˜éŒ„ + æ—ç™½ + ç•«é¢</span>
        </label>
      </div>
    </div>

    <!-- ç”ŸæˆæŒ‰éˆ• -->
    <div class="card">
      <h2 class="text-xl font-semibold mb-3">ç¬¬å››æ­¥ï¼šç”Ÿæˆè…³æœ¬</h2>
      <button id="btnGenerate" class="btn btn-primary">ç¢ºèªç”Ÿæˆ</button>
      <p id="sysMsg" class="text-sm text-gray-600 mt-3"></p>
    </div>

    <!-- çµæœè¼¸å‡º -->
    <div class="card">
      <h2 class="text-xl font-semibold mb-3">çµæœï¼š</h2>
      <div class="flex gap-2 mb-3">
        <button id="btnCopy" class="btn btn-ghost">è¤‡è£½</button>
        <button id="btnDownload" class="btn btn-ghost">ä¸‹è¼‰ .txt</button>
      </div>
      <pre id="output" class="code"></pre>
    </div>
  </main>

  <script>
  const KEY_STORAGE = 'user_api_key';
  let userApiKey = localStorage.getItem(KEY_STORAGE) || '';

  const el = id => document.getElementById(id);
  const keyInput = el('userApiKey');
  const saveBtn = el('btnSaveKey');
  const clearBtn = el('btnClearKey');
  const generateBtn = el('btnGenerate');
  const output = el('output');
  const sysMsg = el('sysMsg');

  if (userApiKey) keyInput.value = '********';

  saveBtn.addEventListener('click', () => {
    const val = keyInput.value.trim();
    if (!val.startsWith('sk-')) return alert('è«‹è¼¸å…¥æ­£ç¢ºæ ¼å¼çš„ API Keyï¼ˆé–‹é ­ç‚º sk-ï¼‰');
    localStorage.setItem(KEY_STORAGE, val);
    userApiKey = val;
    keyInput.value = '********';
    alert('âœ… API Key å·²å„²å­˜æ–¼ç€è¦½å™¨');
  });

  clearBtn.addEventListener('click', () => {
    localStorage.removeItem(KEY_STORAGE);
    userApiKey = '';
    keyInput.value = '';
    alert('ğŸ”’ å·²æ¸…é™¤ API Key');
  });

  generateBtn.addEventListener('click', async () => {
    const text = el('inputText').value.trim();
    if (!text) return alert('è«‹å…ˆè²¼ä¸Šå…§å®¹');
    if (!userApiKey) return alert('è«‹å…ˆè¼¸å…¥ä½ çš„ OpenAI API Key');

    const mode = document.querySelector('input[name="mode"]:checked')?.value || 'topic';

    const basePrompt = `ä½ æ˜¯å°ç£ä¸­æ–‡å…§å®¹è£½ä½œçš„çŸ­å½±éŸ³è…³æœ¬ç·¨åŠ‡ï¼Œè«‹ç”¨ç¹é«”ä¸­æ–‡æ’°å¯« Markdown æ ¼å¼è¼¸å‡ºã€‚`;
    let task = '';
    if (mode === 'podcast') task = 'è«‹é¸å‡º 5 æ®µ 45â€“75 ç§’å¯ä¸€é¡åˆ°åº•çš„é‡é»ç‰‡æ®µï¼Œé™„æ™‚é–“ç¢¼èˆ‡é‡é»';
    else if (mode === 'topic') task = 'è«‹å¯«å‡º 60 ç§’è­°é¡Œå‹æ—ç™½è…³æœ¬ï¼Œé™„å»ºè­°æ™‚é–“èˆ‡ç•«é¢';
    else task = 'è«‹å¯«å‡º 60 ç§’äººç‰©æ•…äº‹å‹è…³æœ¬ï¼ŒåŒ…å«åŸéŸ³æ‘˜éŒ„ã€å¤§æ„èˆ‡å»ºè­°ç•«é¢';

    const prompt = `${basePrompt}\n${task}\nä»¥ä¸‹æ˜¯å…¨æ–‡ï¼š\n${text}`;

    output.textContent = 'â³ æ­£åœ¨ç”Ÿæˆä¸­...';
    sysMsg.textContent = 'è«‹ç¨å€™ï¼ŒAI æ­£åœ¨æ’°å¯«è…³æœ¬';

    try {
      const res = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${userApiKey}`,
        },
        body: JSON.stringify({
          model: 'gpt-5.1-mini',
          messages: [
            { role: 'system', content: 'You are a helpful assistant that writes Traditional Chinese short-video scripts in Markdown.' },
            { role: 'user', content: prompt }
          ],
          temperature: 0.7,
        }),
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data.error?.message || 'API å›å‚³éŒ¯èª¤');

      const textOut = data.choices?.[0]?.message?.content || '(ç„¡å…§å®¹)';
      output.textContent = textOut;
      sysMsg.textContent = 'âœ… å·²å®Œæˆ';
    } catch (err) {
      output.textContent = 'âŒ éŒ¯èª¤ï¼š' + err.message;
      sysMsg.textContent = 'ç™¼ç”ŸéŒ¯èª¤';
    }
  });

  el('btnCopy').addEventListener('click', async () => {
    const text = output.textContent;
    if (!text) return;
    await navigator.clipboard.writeText(text);
    alert('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
  });

  el('btnDownload').addEventListener('click', () => {
    const blob = new Blob([output.textContent], { type: 'text/plain;charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'çŸ­å½±éŸ³è…³æœ¬.txt';
    a.click();
  });
  </script>
</body>
</html>
